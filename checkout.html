<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<title>–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è - –ü—Ä–æ–ó–∞—Ö–∏—Å—Ç</title>
<style>
body { font-family: 'Roboto', sans-serif; margin:0; padding:0; background:#f4f4f4; }
.container { width:33%; margin:auto; padding:20px; background:#fff; box-shadow:0 0 10px rgba(0,0,0,0.1); border-radius:8px; margin-top:20px; }
h1 { text-align:center; }
.cart-item { display:flex; justify-content:space-between; margin:15px 0; padding:10px; border-bottom:1px solid #ddd; }
.total-price { font-size:1.2em; font-weight:bold; text-align:right; margin-top:10px; }
.form-group { margin-bottom:15px; }
.form-group label { display:block; font-weight:bold; }
.form-group input { width:100%; padding:8px; margin-top:5px; box-sizing:border-box; border:1px solid #ddd; border-radius:4px; font-size: 1.1em; }
.submit-button { width:100%; padding:10px; background:#4CAF50; color:#fff; font-size:1.1em; font-weight:bold; border:none; border-radius:5px; cursor:pointer; text-decoration:none; }
.submit-button:hover { background:#45a049; }

#order-header { text-align: center; margin-bottom: 15px; }

.fade-line { opacity:0; transition: opacity 2s ease; font-size:1.2em; font-weight:bold; margin-bottom: 5px; }
.fade-line.show { opacity:1; }

.toast-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.4);
  display:flex; justify-content: center; align-items: center; opacity:0; visibility:hidden;
  transition: opacity 0.6s ease, visibility 0.6s ease; z-index:10000; }
.toast-overlay.show { opacity:1; visibility:visible; }
.toast-message { background:#4CAF50; color:#fff; padding:20px 40px; border-radius:8px; font-size:1.5em;
  text-align:center; font-weight:bold; opacity:0; transform: scale(0.7);
  transition: transform 0.6s ease, opacity 0.6s ease; }
.toast-overlay.show .toast-message { opacity:1; transform: scale(1); }

.button-row { display:flex; justify-content:space-between; gap:10px; }
.button-row .submit-button { flex:1; }

.pay-button { background:#2b7cff; display:none; opacity:0; transition:opacity 0.5s ease; text-align:center; }
.pay-button:hover { background:#1e5fcc; }

@media(max-width:768px){
.container{width:90%;padding:15px;}
.button-row{flex-direction:column;}
.submit-button{font-size:1.3em;}
}
</style>
</head>
<body>

<div class="container">
  <h1>–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h1>
  <h2 id="order-header">–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
  <div id="cart-items"></div>
  <div class="total-price" id="total-price"></div>

  <h2>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ</h2>
  <form id="checkout-form" action="https://formspree.io/f/xrbadqqk" method="POST">
    <div class="form-group">
      <label for="name">–ü—Ä—ñ–∑–≤–∏—â–µ, –Ü–º'—è</label>
      <input type="text" id="name" name="name" required>
    </div>
    <div class="form-group">
      <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω –æ—Ç—Ä–∏–º—É–≤–∞—á–∞</label>
      <input type="tel" id="phone" name="phone" required>
    </div>
    <div class="form-group">
      <label for="city">–ú—ñ—Å—Ç–æ</label>
      <input type="text" id="city" name="city" required>
    </div>
    <div class="form-group">
      <label for="branch">–ù–æ–º–µ—Ä –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è "–ù–æ–≤–æ—ó –ü–æ—à—Ç–∏"</label>
      <input type="tel" id="branch" name="branch" required>
    </div>

    <input type="hidden" id="cart-data" name="cart">

    <div class="button-row">
      <button type="submit" class="submit-button">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
      <a id="pay-button" href="#" target="_blank" class="submit-button pay-button">üí≥ –°–ø–ª–∞—Ç–∏—Ç–∏ –∫–∞—Ä—Ç–∫–æ—é</a>
    </div>
  </form>
</div>

<div class="toast-overlay" id="toast">
  <div class="toast-message">–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ! –î—è–∫—É—î–º–æ!</div>
</div>

<audio id="cash-sound" src="sound.mp3"></audio>

<script>
let cart = JSON.parse(localStorage.getItem('cart')) || [];

function getDailyOrderNumber(){
  const today=new Date().toISOString().slice(0,10);
  let data=JSON.parse(localStorage.getItem('dailyOrders')||'{}');
  if(!data.date||data.date!==today){data={date:today,number:0};}
  data.number=(data.number%99)+1;
  localStorage.setItem('dailyOrders',JSON.stringify(data));
  return data.number;
}

function generateOrderNumber(){
  const n=getDailyOrderNumber();
  const d=new Date();
  return `${String(n).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getFullYear()).slice(-2)}`;
}

function calculateDiscount(total){
  if(total>=100000) return 15;
  if(total>=40000) return 13;
  if(total>=20000) return 10;
  if(total>=10000) return 7;
  if(total>=5000) return 5;
  if(total>=500) return 3;
  return 0;
}

function createLine(text,color="#000"){
  const l=document.createElement('div');
  l.classList.add('fade-line');l.textContent=text;l.style.color=color;
  l.style.fontSize="1.0em";l.style.fontWeight="bold";return l;
}

function animateNumber(el,start,end,dur){
  const range=end-start;let st=null;
  function step(t){if(!st)st=t;const p=Math.min((t-st)/dur,1);
  el.textContent=`–î–æ —Å–ø–ª–∞—Ç–∏: ${Math.round(start+range*p).toFixed(2)} –≥—Ä–Ω`;
  if(p<1)window.requestAnimationFrame(step);else{const s=document.getElementById('cash-sound');s.volume=0.15;s.play();}}
  window.requestAnimationFrame(step);
}

function displayOrder(){
  const cont=document.getElementById('cart-items');
  const totalEl=document.getElementById('total-price');
  const cartField=document.getElementById('cart-data');
  cont.innerHTML='';totalEl.innerHTML='';
  let total=0,txt='';
  cart.forEach(i=>{
    const s=i.price*i.quantity;total+=s;
    cont.innerHTML+=`<div class="cart-item">${i.name} ‚Äî ${i.price} –≥—Ä–Ω √ó ${i.quantity} = ${s} –≥—Ä–Ω</div>`;
    txt+=`${i.name} ‚Äî ${i.price} –≥—Ä–Ω √ó ${i.quantity} = ${s} –≥—Ä–Ω\n`;
  });
  const disc=calculateDiscount(total);
  const dAmt=total*disc/100;
  const final=total-dAmt;
  const num=generateOrderNumber();
  document.getElementById('order-header').textContent=`–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ññ${num}`;

  totalEl.append(createLine(`–°—É–º–∞: ${total.toFixed(2)} –≥—Ä–Ω`));
  const discLine=createLine(`–ó–Ω–∏–∂–∫–∞: - ${dAmt.toFixed(2)} –≥—Ä–Ω`,disc>0?"green":"gray");
  totalEl.append(discLine); setTimeout(()=>discLine.classList.add('show'),1000);
  const fLine=createLine(`–î–æ —Å–ø–ª–∞—Ç–∏: 0 –≥—Ä–Ω`); totalEl.append(fLine);
  setTimeout(()=>{fLine.classList.add('show');animateNumber(fLine,0,final,1500);},2000);

  cartField.value=`–ù–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: ${num}\n${txt}\n–î–æ —Å–ø–ª–∞—Ç–∏: ${final.toFixed(2)} –≥—Ä–Ω`;
  // —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É –¥–ª—è –∫–Ω–æ–ø–∫–∏
  document.getElementById("pay-button").dataset.amount = final.toFixed(2);
}

displayOrder();

// === –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã ===
const inputs=document.querySelectorAll('#name,#phone,#city,#branch');
const payBtn=document.getElementById('pay-button');
function checkFormCompletion(){
  const allFilled=Array.from(inputs).every(i=>i.value.trim()!=='');
  if(allFilled){
    payBtn.style.display='block';
    setTimeout(()=>payBtn.style.opacity='1',100);
  } else {
    payBtn.style.opacity='0';
    setTimeout(()=>payBtn.style.display='none',300);
  }
}
inputs.forEach(i=>i.addEventListener('input',checkFormCompletion));

// === –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–°–ø–ª–∞—Ç–∏—Ç–∏ –∫–∞—Ä—Ç–∫–æ—é" ===
payBtn.addEventListener('click',function(e){
  e.preventDefault();
  const form=document.getElementById('checkout-form');
  const data=new FormData(form);
  const amount=this.dataset.amount||"0.00";
  data.set("cart",document.getElementById("cart-data").value + "\n\nüí≥ –û–ø–ª–∞—á–µ–Ω–æ –∫–∞—Ä—Ç–∫–æ—é ‚úÖ");
  fetch(form.action,{method:form.method,body:data,headers:{'Accept':'application/json'}})
  .then(r=>{
    if(r.ok){
      const link="https://payhub.privatbank.ua/l/abc12345"; // üîπ –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ—é —Å—Å—ã–ª–∫—É
      window.location.href=`${link}?amount=${amount}`;
    } else alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.");
  }).catch(()=>alert("–ü–æ–º–∏–ª–∫–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è —ñ–∑ —Å–µ—Ä–≤–µ—Ä–æ–º."));
});

// === –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—ã—á–Ω–æ–π —Ñ–æ—Ä–º—ã ===
document.getElementById('checkout-form').addEventListener('submit',function(e){
  e.preventDefault();
  const f=e.target;const d=new FormData(f);
  fetch(f.action,{method:f.method,body:d,headers:{'Accept':'application/json'}})
  .then(r=>{
    if(r.ok){
      showToast();
      localStorage.removeItem('cart');
      f.reset();
      setTimeout(()=>window.location.href="index.html",3000);
    } else alert("–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.");
  }).catch(()=>alert("–ü–æ–º–∏–ª–∫–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è —ñ–∑ —Å–µ—Ä–≤–µ—Ä–æ–º."));
});

function showToast(){
  const t=document.getElementById('toast');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2500);
}
</script>
</body>
</html>
