<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<title>–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è - –ü—Ä–æ–ó–∞—Ö–∏—Å—Ç</title>
<style>
body { font-family: 'Roboto', sans-serif; margin:0; padding:0; background:#f4f4f4; }
.container { width:33%; margin:auto; padding:20px; background:#fff; box-shadow:0 0 10px rgba(0,0,0,0.1); border-radius:8px; margin-top:20px; }
h1 { text-align:center; }
.cart-item { display:flex; justify-content:space-between; margin:15px 0; padding:10px; border-bottom:1px solid #ddd; }
.total-price { font-size:1.2em; font-weight:bold; text-align:right; margin-top:10px; }
.form-group { margin-bottom:15px; }
.form-group label { display:block; font-weight:bold; }
.form-group input { width:100%; padding:8px; margin-top:5px; box-sizing:border-box; border:1px solid #ddd; border-radius:4px; font-size: 1.1em; }
.submit-button { width:100%; padding:10px; background:#4CAF50; color:#fff; font-size:1.1em; font-weight:bold; border:none; border-radius:5px; cursor:pointer; }
.submit-button:hover { background:#45a049; }
#order-header { text-align:center; margin-bottom:15px; }
.fade-line { opacity:0; transition: opacity 2s ease; font-size:1.2em; font-weight:bold; margin-bottom:5px; }
.fade-line.show { opacity:1; }

.toast-overlay {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.4); display:flex; justify-content:center; align-items:center;
  opacity:0; visibility:hidden; transition:opacity 0.6s ease, visibility 0.6s ease; z-index:10000;
}
.toast-overlay.show { opacity:1; visibility:visible; }
.toast-message {
  background:#4CAF50; color:#fff; padding:20px 40px; border-radius:8px;
  font-size:1.3em; text-align:center; font-weight:bold;
  opacity:0; transform:scale(0.7);
  transition:transform 0.6s ease, opacity 0.6s ease;
}
.toast-overlay.show .toast-message { opacity:1; transform:scale(1); }

@media(max-width:768px) {
  .container { width:90%; padding:15px; }
  h1 { font-size:1.6em; font-weight:bold; }
  .cart-item { flex-direction:column; text-align:left; }
  .total-price { font-size:1.1em; text-align:right; }
  .submit-button { font-size:1.5em; padding:8px; }
}

.button-row { display:flex; justify-content:space-between; gap:10px; }
.button-row .submit-button { flex:1; text-decoration:none; }
.pay-button { background:#2b7cff; display:none; text-align:center; }
.pay-button:hover { background:#1e5fcc; }
</style>
</head>
<body>

<div class="container">
  <h1>–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h1>
  <h2 id="order-header">–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
  <div id="cart-items"></div>
  <div class="total-price" id="total-price"></div>

  <h2>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ</h2>
  <form id="checkout-form" action="https://formspree.io/f/xrbadqqk" method="POST">
    <div class="form-group">
      <label for="name">–ü—Ä—ñ–∑–≤–∏—â–µ, –Ü–º'—è</label>
      <input type="text" id="name" name="name" required>
    </div>
    <div class="form-group">
      <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω –æ—Ç—Ä–∏–º—É–≤–∞—á–∞</label>
      <input type="tel" id="phone" name="phone" required>
    </div>
    <div class="form-group">
      <label for="city">–ú—ñ—Å—Ç–æ</label>
      <input type="text" id="city" name="city" required>
    </div>
    <div class="form-group">
      <label for="branch">–ù–æ–º–µ—Ä –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è "–ù–æ–≤–æ—ó –ü–æ—à—Ç–∏"</label>
      <input type="tel" id="branch" name="branch" required>
    </div>
    <input type="hidden" id="cart-data" name="cart">

    <div class="button-row">
      <button type="submit" class="submit-button">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
      <a id="pay-button" href="#" class="submit-button pay-button">üí≥ –°–ø–ª–∞—Ç–∏—Ç–∏ –∫–∞—Ä—Ç–∫–æ—é</a>
    </div>
  </form>
</div>

<div class="toast-overlay" id="toast">
  <div class="toast-message"></div>
</div>

<audio id="cash-sound" src="sound.mp3"></audio>

<script>
let cart = JSON.parse(localStorage.getItem('cart')) || [];

// –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –Ω–æ–º–µ—Ä–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
function getDailyOrderNumber() {
  const today = new Date().toISOString().slice(0, 10);
  let ordersData = JSON.parse(localStorage.getItem('dailyOrders') || '{}');
  if (!ordersData.date || ordersData.date !== today) ordersData = { date: today, number: 0 };
  ordersData.number = (ordersData.number % 99) + 1;
  localStorage.setItem('dailyOrders', JSON.stringify(ordersData));
  return ordersData.number;
}
function generateOrderNumber() {
  const orderNum = getDailyOrderNumber();
  const now = new Date();
  const d = String(now.getDate()).padStart(2, '0');
  const m = String(now.getMonth() + 1).padStart(2, '0');
  const y = String(now.getFullYear()).slice(-2);
  return `${String(orderNum).padStart(2, '0')}${d}${m}${y}`;
}

// –ó–Ω–∏–∂–∫–∞
function calculateDiscount(total) {
  if (total >= 100000) return 15;
  if (total >= 40000) return 13;
  if (total >= 20000) return 10;
  if (total >= 10000) return 7;
  if (total >= 5000) return 5;
  if (total >= 500) return 3;
  return 0;
}

// –ê–Ω—ñ–º–∞—Ü—ñ—è —Å—É–º–∏
function animateNumber(el, start, end, duration) {
  const range = end - start;
  let startTime = null;
  function step(timestamp) {
    if (!startTime) startTime = timestamp;
    const progress = Math.min((timestamp - startTime) / duration, 1);
    el.textContent = `–î–æ —Å–ø–ª–∞—Ç–∏: ${Math.round(start + range * progress).toFixed(2)} –≥—Ä–Ω`;
    if (progress < 1) window.requestAnimationFrame(step);
    else { const sound = document.getElementById('cash-sound'); sound.volume = 0.15; sound.play(); }
  }
  window.requestAnimationFrame(step);
}

// –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
function displayOrder() {
  const container = document.getElementById('cart-items');
  const totalPriceEl = document.getElementById('total-price');
  const cartData = document.getElementById('cart-data');
  container.innerHTML = ''; totalPriceEl.innerHTML = '';

  let total = 0, cartText = '';
  cart.forEach(item => {
    const subtotal = item.price * item.quantity;
    total += subtotal;
    const div = document.createElement('div');
    div.classList.add('cart-item');
    div.textContent = `${item.name} ‚Äî ${item.price} –≥—Ä–Ω √ó ${item.quantity} = ${subtotal} –≥—Ä–Ω`;
    container.appendChild(div);
    cartText += `${item.name} ‚Äî ${item.price} –≥—Ä–Ω √ó ${item.quantity} = ${subtotal} –≥—Ä–Ω\n`;
  });

  const discount = calculateDiscount(total);
  const discountAmount = total * discount / 100;
  const finalTotal = total - discountAmount;
  const orderNum = generateOrderNumber();
  document.getElementById('order-header').textContent = `–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ññ${orderNum}`;

  const totalLine = document.createElement('div');
  totalLine.classList.add('fade-line','show');
  totalLine.textContent = `–°—É–º–∞: ${total.toFixed(2)} –≥—Ä–Ω`;
  totalPriceEl.appendChild(totalLine);

  const discLine = document.createElement('div');
  discLine.classList.add('fade-line','show');
  discLine.textContent = discount>0?`–ó–Ω–∏–∂–∫–∞: -${discountAmount.toFixed(2)} –≥—Ä–Ω`:`–ó–Ω–∏–∂–∫–∞: 0 –≥—Ä–Ω`;
  totalPriceEl.appendChild(discLine);

  const finalLine = document.createElement('div');
  finalLine.classList.add('fade-line','show');
  totalPriceEl.appendChild(finalLine);
  setTimeout(()=>animateNumber(finalLine,0,finalTotal,1500),1000);

  cartData.value =
    `–ù–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: ${orderNum}\n${cartText}\n–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: ${total.toFixed(2)} –≥—Ä–Ω`+
    (discount>0?`\n–ó–Ω–∏–∂–∫–∞ ${discount}%: -${discountAmount.toFixed(2)} –≥—Ä–Ω\n–î–æ —Å–ø–ª–∞—Ç–∏: ${finalTotal.toFixed(2)} –≥—Ä–Ω`
    :`\n–î–æ —Å–ø–ª–∞—Ç–∏: ${finalTotal.toFixed(2)} –≥—Ä–Ω`);

  setTimeout(()=>{
    const payBtn=document.getElementById('pay-button');
    payBtn.style.display='block';
    payBtn.dataset.amount=finalTotal.toFixed(2);
  },3000);
}
displayOrder();

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
const inputs = document.querySelectorAll('#name, #phone, #city, #branch');
const payButton = document.getElementById('pay-button');
function checkFormCompletion() {
  const filled = Array.from(inputs).every(i=>i.value.trim()!=='');
  payButton.style.opacity = filled?'1':'0.5';
  payButton.style.pointerEvents='auto';
}
inputs.forEach(i=>i.addEventListener('input',checkFormCompletion));

// Toast
function showToast(msg) {
  const toast=document.getElementById('toast');
  const message=toast.querySelector('.toast-message');
  message.textContent=msg;
  toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'),2500);
}

// –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º–∏
document.getElementById('checkout-form').addEventListener('submit',e=>{
  e.preventDefault();
  const form=e.target;
  const empty=Array.from(inputs).filter(i=>i.value.trim()==='');
  if(empty.length){ showToast("‚ö†Ô∏è –ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è!"); return; }

  const data=new FormData(form);
  fetch(form.action,{method:form.method,body:data,headers:{'Accept':'application/json'}})
  .then(r=>{
    if(r.ok){
      showToast("‚úÖ –í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!");
      localStorage.removeItem('cart');
      form.reset();
      displayOrder();
      setTimeout(()=>window.location.href="index.html",3000);
    } else showToast("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.");
  })
  .catch(()=>showToast("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è —ñ–∑ —Å–µ—Ä–≤–µ—Ä–æ–º."));
});

// –û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–∫–æ—é
payButton.addEventListener('click',e=>{
  e.preventDefault();
  const empty=Array.from(inputs).filter(i=>i.value.trim()==='');
  if(empty.length){ showToast("‚ö†Ô∏è –ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è!"); return; }

  const form=document.getElementById('checkout-form');
  const data=new FormData(form);
  let current=document.getElementById('cart-data').value;
  current+="\n\nüí≥ –û–ø–ª–∞—á–µ–Ω–æ –∫–∞—Ä—Ç–∫–æ—é ‚úÖ";
  data.set('cart',current);

  fetch(form.action,{method:form.method,body:data,headers:{'Accept':'application/json'}})
  .then(r=>{
    if(r.ok){
      const amount=this.dataset.amount||0;
      const link="https://payhub.privatbank.ua/l/abc12345";
      window.location.href=link+"?amount="+amount;
    } else showToast("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.");
  })
  .catch(()=>showToast("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è —ñ–∑ —Å–µ—Ä–≤–µ—Ä–æ–º."));
});
</script>

</body>
</html>
