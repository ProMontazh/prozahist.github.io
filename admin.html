<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å - –ü—Ä–æ–ó–∞—Ö–∏—Å—Ç</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      background-color: #f4f4f4;
    }

    /* ===== –§–æ—Ä–º–∞ –≤—Ö–æ–¥—É ===== */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .login-box {
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      width: 100%;
      max-width: 400px;
    }

    .login-box h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
      font-size: 28px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
      transition: border 0.3s;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
      font-family: inherit;
    }

    .btn-login {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .btn-login:hover {
      transform: translateY(-2px);
    }

    .error-message {
      color: #dc3545;
      text-align: center;
      margin-top: 15px;
      display: none;
      font-size: 14px;
    }

    /* ===== –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å ===== */
    .admin-panel {
      display: none;
    }

    .admin-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .admin-header h1 {
      font-size: 24px;
    }

    .admin-content {
      max-width: 1400px;
      margin: 30px auto;
      padding: 0 20px;
    }

    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 30px;
      background: white;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .tab {
      padding: 12px 25px;
      cursor: pointer;
      background: transparent;
      border: none;
      font-size: 15px;
      font-weight: 500;
      color: #666;
      border-radius: 8px;
      transition: all 0.3s;
    }

    .tab:hover {
      background: #f0f0f0;
    }

    .tab.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .tab-content {
      display: none;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .tab-content.active {
      display: block;
    }

    .section-title {
      font-size: 22px;
      margin-bottom: 25px;
      color: #333;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-success {
      background-color: #28a745;
      color: white;
    }

    .btn-success:hover {
      background-color: #218838;
    }

    .btn-danger {
      background-color: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background-color: #c82333;
    }

    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background-color: #5a6268;
    }

    .btn-edit {
      background-color: #ffc107;
      color: #000;
    }

    .btn-edit:hover {
      background-color: #e0a800;
    }

    /* ===== –¢–∞–±–ª–∏—Ü—ñ ===== */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .data-table th,
    .data-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }

    .data-table th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #333;
      position: sticky;
      top: 0;
    }

    .data-table tr:hover {
      background-color: #f8f9fa;
    }

    .data-table img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 5px;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
    }

    /* ===== –§–æ—Ä–º–∏ ===== */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-grid-full {
      grid-column: 1 / -1;
    }

    /* ===== –ö–∞—Ä—Ç–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π ===== */
    .categories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .category-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }

    .category-card:hover {
      transform: translateY(-5px);
    }

    .category-card h3 {
      margin-bottom: 15px;
      font-size: 20px;
    }

    .category-card .product-count {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 15px;
    }

    .category-card .action-buttons {
      margin-top: 15px;
    }

    .category-card .btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
    }

    .category-card .btn:hover {
      background: rgba(255,255,255,0.3);
    }

    /* ===== –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ===== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      text-align: center;
    }

    .stat-card .number {
      font-size: 36px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 10px;
    }

    .stat-card .label {
      color: #666;
      font-size: 14px;
    }

    /* ===== –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ ===== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      overflow-y: auto;
    }

    .modal-content {
      background: white;
      max-width: 600px;
      margin: 50px auto;
      padding: 30px;
      border-radius: 10px;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 28px;
      cursor: pointer;
      color: #999;
    }

    .modal-close:hover {
      color: #333;
    }

    /* ===== –ü–æ—à—É–∫ —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä–∏ ===== */
    .search-bar {
      margin-bottom: 20px;
    }

    .search-bar input {
      width: 100%;
      max-width: 400px;
      padding: 12px 20px;
      border: 2px solid #e0e0e0;
      border-radius: 25px;
      font-size: 15px;
    }

    .search-bar input:focus {
      outline: none;
      border-color: #667eea;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state svg {
      width: 100px;
      height: 100px;
      margin-bottom: 20px;
      opacity: 0.3;
    }
  </style>
</head>
<body>

<!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥—É -->
<div class="login-container" id="loginContainer">
  <div class="login-box">
    <h2>üîê –í—Ö—ñ–¥ –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h2>
    <form id="loginForm">
      <div class="form-group">
        <label>–õ–æ–≥—ñ–Ω</label>
        <input type="text" id="username" placeholder="–í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω" required>
      </div>
      <div class="form-group">
        <label>–ü–∞—Ä–æ–ª—å</label>
        <input type="password" id="password" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" required>
      </div>
      <button type="submit" class="btn-login">–£–≤—ñ–π—Ç–∏</button>
      <div class="error-message" id="errorMessage">‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å</div>
    </form>
  </div>
</div>

<!-- –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å -->
<div class="admin-panel" id="adminPanel">
  <div class="admin-header">
    <h1>‚öôÔ∏è –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å –ü—Ä–æ–ó–∞—Ö–∏—Å—Ç</h1>
    <button class="btn btn-secondary" onclick="logout()">–í–∏–π—Ç–∏</button>
  </div>

  <div class="admin-content">
    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="tabs">
      <button class="tab active" onclick="showTab('dashboard')">üìä –ü–∞–Ω–µ–ª—å</button>
      <button class="tab" onclick="showTab('categories')">üìÅ –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</button>
      <button class="tab" onclick="showTab('products')">üì¶ –¢–æ–≤–∞—Ä–∏</button>
      <button class="tab" onclick="showTab('orders')">üõí –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ "–ü–∞–Ω–µ–ª—å" -->
    <div class="tab-content active" id="dashboard-tab">
      <h2 class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
      <div class="stats-grid" id="statsGrid">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ —Ç—É—Ç -->
      </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ "–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó" -->
    <div class="tab-content" id="categories-tab">
      <h2 class="section-title">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏</h2>
      
      <form id="categoryForm" style="margin-bottom: 30px;">
        <div class="form-grid">
          <div class="form-group">
            <label>–ù–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó *</label>
            <input type="text" id="categoryName" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –î–∞—Ç—á–∏–∫–∏ —Ä—É—Ö—É" required>
          </div>
          <div class="form-group">
            <label>ID –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó *</label>
            <input type="text" id="categoryId" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: motion-sensors" required>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">‚ûï –î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</button>
      </form>

      <div class="categories-grid" id="categoriesList">
        <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –±—É–¥—É—Ç—å —Ç—É—Ç -->
      </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ "–¢–æ–≤–∞—Ä–∏" -->
    <div class="tab-content" id="products-tab">
      <h2 class="section-title">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏</h2>
      
      <div class="search-bar">
        <input type="text" id="productSearch" placeholder="üîç –ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—ñ–≤..." onkeyup="filterProducts()">
      </div>

      <button class="btn btn-success" onclick="openProductModal()" style="margin-bottom: 20px;">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</button>

      <table class="data-table" id="productsTable">
        <thead>
          <tr>
            <th>–§–æ—Ç–æ</th>
            <th>ID</th>
            <th>–ù–∞–∑–≤–∞</th>
            <th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th>
            <th>–¶—ñ–Ω–∞</th>
            <th>–î—ñ—ó</th>
          </tr>
        </thead>
        <tbody id="productsTableBody">
          <!-- –¢–æ–≤–∞—Ä–∏ –±—É–¥—É—Ç—å —Ç—É—Ç -->
        </tbody>
      </table>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ "–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è" -->
    <div class="tab-content" id="orders-tab">
      <h2 class="section-title">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç—ñ–≤</h2>
      
      <table class="data-table" id="ordersTable">
        <thead>
          <tr>
            <th>‚Ññ</th>
            <th>–î–∞—Ç–∞</th>
            <th>–ö–ª—ñ—î–Ω—Ç</th>
            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <th>–ê–¥—Ä–µ—Å–∞</th>
            <th>–¢–æ–≤–∞—Ä–∏</th>
            <th>–°—É–º–∞</th>
            <th>–î—ñ—ó</th>
          </tr>
        </thead>
        <tbody id="ordersTableBody">
          <!-- –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –±—É–¥—É—Ç—å —Ç—É—Ç -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è —Ç–æ–≤–∞—Ä—É -->
<div class="modal" id="productModal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeProductModal()">&times;</span>
    <h2 class="section-title" id="modalTitle">–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</h2>
    
    <form id="productForm">
      <input type="hidden" id="editProductIndex">
      
      <div class="form-grid">
        <div class="form-group">
          <label>ID —Ç–æ–≤–∞—Ä—É *</label>
          <input type="text" id="productId" placeholder="hub-white" required>
        </div>
        <div class="form-group">
          <label>–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É *</label>
          <input type="text" id="productName" placeholder="Ajax Hub White" required>
        </div>
      </div>

      <div class="form-group">
        <label>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è *</label>
        <select id="productCategory" required>
          <option value="">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>
        </select>
      </div>

      <div class="form-group">
        <label>–û–ø–∏—Å —Ç–æ–≤–∞—Ä—É *</label>
        <textarea id="productDescription" placeholder="–î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å —Ç–æ–≤–∞—Ä—É..." required></textarea>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label>–¶—ñ–Ω–∞ (–≥—Ä–Ω) *</label>
          <input type="number" id="productPrice" placeholder="6700" step="0.01" required>
        </div>
        <div class="form-group">
          <label>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è (URL) *</label>
          <input type="text" id="productImage" placeholder="images/ajax_hub_white_1.jpg" required>
        </div>
      </div>

      <div class="form-group">
        <label>–°—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–µ—Ç–∞–ª–µ–π (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</label>
        <input type="text" id="productDetailsPage" placeholder="details_hub_1.html">
      </div>

      <div class="form-group">
        <label>–î–æ–¥–∞—Ç–∫–æ–≤—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (—á–µ—Ä–µ–∑ –∫–æ–º—É)</label>
        <input type="text" id="productImages" placeholder="images/image2.jpg, images/image3.jpg">
      </div>

      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button type="submit" class="btn btn-primary">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
        <button type="button" class="btn btn-secondary" onclick="closeProductModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      </div>
    </form>
  </div>
</div>

<script>
// ===== –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø =====
const ADMIN_CREDENTIALS = {
  username: 'admin',
  password: 'ProZakhyst'  // –ó–ú–Ü–ù–Ü–¢–¨ –ù–ê –°–í–Ü–ô –ü–ê–†–û–õ–¨!
};

const STORAGE_KEYS = {
  categories: 'ajax_categories',
  products: 'ajax_products',
  orders: 'orders',
  auth: 'adminLoggedIn'
};

// ===== –ê–í–¢–û–†–ò–ó–ê–¶–Ü–Ø =====
function checkAuth() {
  const isLoggedIn = localStorage.getItem(STORAGE_KEYS.auth);
  if (isLoggedIn === 'true') {
    showAdminPanel();
  }
}

document.getElementById('loginForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;

  if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
    localStorage.setItem(STORAGE_KEYS.auth, 'true');
    showAdminPanel();
  } else {
    document.getElementById('errorMessage').style.display = 'block';
  }
});

function logout() {
  localStorage.removeItem(STORAGE_KEYS.auth);
  document.getElementById('loginContainer').style.display = 'flex';
  document.getElementById('adminPanel').style.display = 'none';
  document.getElementById('loginForm').reset();
}

function showAdminPanel() {
  document.getElementById('loginContainer').style.display = 'none';
  document.getElementById('adminPanel').style.display = 'block';
  loadStats();
  loadCategories();
  loadProducts();
  loadOrders();
}

// ===== –í–ö–õ–ê–î–ö–ò =====
function showTab(tabName) {
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });

  document.getElementById(tabName + '-tab').classList.add('active');
  event.target.classList.add('active');

  if (tabName === 'dashboard') loadStats();
  if (tabName === 'categories') loadCategories();
  if (tabName === 'products') loadProducts();
  if (tabName === 'orders') loadOrders();
}

// ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê =====
function loadStats() {
  const categories = JSON.parse(localStorage.getItem(STORAGE_KEYS.categories)) || [];
  const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.products)) || [];
  const orders = JSON.parse(localStorage.getItem(STORAGE_KEYS.orders)) || [];
  
  const totalRevenue = orders.reduce((sum, order) => sum + (order.total || 0), 0);

  const html = `
    <div class="stat-card">
      <div class="number">${categories.length}</div>
      <div class="label">–ö–∞—Ç–µ–≥–æ—Ä—ñ–π</div>
    </div>
    <div class="stat-card">
      <div class="number">${products.length}</div>
      <div class="label">–¢–æ–≤–∞—Ä—ñ–≤</div>
    </div>
    <div class="stat-card">
      <div class="number">${orders.length}</div>
      <div class="label">–ó–∞–º–æ–≤–ª–µ–Ω—å</div>
    </div>
    <div class="stat-card">
      <div class="number">${totalRevenue.toFixed(2)}</div>
      <div class="label">–î–æ—Ö—ñ–¥ (–≥—Ä–Ω)</div>
    </div>
  `;

  document.getElementById('statsGrid').innerHTML = html;
}

// ===== –ö–ê–¢–ï–ì–û–†–Ü–á =====
document.getElementById('categoryForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const category = {
    id: document.getElementById('categoryId').value.trim(),
    name: document.getElementById('categoryName').value.trim()
  };

  let categories = JSON.parse(localStorage.getItem(STORAGE_KEYS.categories)) || [];
  
  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª—ñ–∫–∞—Ç
  if (categories.find(c => c.id === category.id)) {
    alert('‚ùå –ö–∞—Ç–µ–≥–æ—Ä—ñ—è –∑ —Ç–∞–∫–∏–º ID –≤–∂–µ —ñ—Å–Ω—É—î!');
    return;
  }

  categories.push(category);
  localStorage.setItem(STORAGE_KEYS.categories, JSON.stringify(categories));

  alert('‚úÖ –ö–∞—Ç–µ–≥–æ—Ä—ñ—é –¥–æ–¥–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!');
  this.reset();
  loadCategories();
  loadStats();
});

function loadCategories() {
  const categories = JSON.parse(localStorage.getItem(STORAGE_KEYS.categories)) || [];
  const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.products)) || [];
  const categoriesList = document.getElementById('categoriesList');

  if (categories.length === 0) {
    categoriesList.innerHTML = `
      <div class="empty-state" style="grid-column: 1 / -1;">
        <p>üìÅ –ö–∞—Ç–µ–≥–æ—Ä—ñ–π –ø–æ–∫–∏ –Ω–µ–º–∞—î</p>
      </div>
    `;
    return;
  }

  let html = '';
  categories.forEach((category, index) => {
    const productCount = products.filter(p => p.category === category.id).length;
    
    html += `
      <div class="category-card">
        <h3>${category.name}</h3>
        <div class="product-count">üì¶ –¢–æ–≤–∞—Ä—ñ–≤: ${productCount}</div>
        <div class="action-buttons">
          <button class="btn btn-danger" onclick="deleteCategory(${index}, '${category.id}')">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
        </div>
      </div>
    `;
  });

  categoriesList.innerHTML = html;
  updateCategoryDropdown();
}

function updateCategoryDropdown() {
  const categories = JSON.parse(localStorage.getItem(STORAGE_KEYS.categories)) || [];
  const select = document.getElementById('productCategory');
  
  let options = '<option value="">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>';
  categories.forEach(cat => {
    options += `<option value="${cat.id}">${cat.name}</option>`;
  });
  
  select.innerHTML = options;
}

function deleteCategory(index, categoryId) {
  const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.products)) || [];
  const hasProducts = products.some(p => p.category === categoryId);

  if (hasProducts) {
    alert('‚ùå –ù–µ–º–æ–∂–ª–∏–≤–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å —Ç–æ–≤–∞—Ä–∏!');
    return;
  }

  if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –∫–∞—Ç–µ–≥–æ—Ä—ñ—é?')) {
    let categories = JSON.parse(localStorage.getItem(STORAGE_KEYS.categories)) || [];
    categories.splice(index, 1);
    localStorage.setItem(STORAGE_KEYS.categories, JSON.stringify(categories));
    loadCategories();
    loadStats();
  }
}

// ===== –¢–û–í–ê–†–ò =====
function openProductModal(index = null) {
  document.getElementById('productModal').style.display = 'block';
  document.getElementById('productForm').reset();
  document.getElementById('editProductIndex').value = '';
  document.getElementById('modalTitle').textContent = '–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä';

  if (index !== null) {
    const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.products)) || [];
    const product = products[index];
    
    document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä';
    document.getElementById('editProductIndex').value = index;
    document.getElementById('productId').value = product.id;
    document.getElementById('productName').value = product.name;
    document.getElementById('productCategory').value = product.category;
    document.getElementById('productDescription').value = product.description;
    document.getElementById('productPrice').value = product.price;
    document.getElementById('productImage').value = product.image;
    document.getElementById('productDetailsPage').value = product.detailsPage || '';
    document.getElementById('productImages').value = product.images ? product.images.join(', ') : '';
  }

  updateCategoryDropdown();
}

function closeProductModal() {
  document.getElementById('productModal').style.display = 'none';
}

document.getElementById('productForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const product = {
    id: document.getElementById('productId').value.trim(),
    name: document.getElementById('productName').value.trim(),
    category: document.getElementById('productCategory').value,
    description: document.getElementById('productDescription').value.trim(),
    price: parseFloat(document.getElementById('productPrice').value),
    image: document.getElementById('productImage').value.trim(),
    detailsPage: document.getElementById('productDetailsPage').value.trim() || null,
    images: document.getElementById('productImages').value.split(',').map(img => img.trim()).filter(img => img)
  };

  let products = JSON.parse(localStorage.getItem(STORAGE_KEYS.products)) || [];
  const editIndex = document.getElementById('editProductIndex').value;

  if (editIndex !== '') {
    // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
    products[editIndex] = product;
    alert('‚úÖ –¢–æ–≤–∞—Ä –æ–Ω–æ–≤–ª–µ–Ω–æ!');
  } else {
    // –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ
    if (products.find(p => p.id === product.id)) {
      alert('‚ùå –¢–æ–≤–∞—Ä –∑ —Ç–∞–∫–∏–º ID –≤–∂–µ —ñ—Å–Ω—É—î!');
      return;
    }
    products.push(product);
    alert('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–¥–∞–Ω–æ!');
  }

  localStorage.setItem(STORAGE_KEYS.products, JSON.stringify(products));
  closeProductModal();
  loadProducts();
  loadStats();
});

function loadProducts() {
  const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.products)) || [];
  const categories = JSON.parse(localStorage.getItem(STORAGE_KEYS.categories)) || [];
  const tbody = document.getElementById('productsTableBody');

  if (products.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #999;">üì¶ –¢–æ–≤–∞—Ä—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î</td></tr>';
    return;
  }

  let html = '';
  products.forEach((product, index) => {
    const category = categories.find(c => c.id === product.category);
    const categoryName = category ? category.name : '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó';

    html += `
      <tr data-product-id="${product.id}" data-product-name="${product.name.toLowerCase()}">
        <td><img src="${product.image}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/60'"></td>
        <td><code>${product.id}</code></td>
        <td><strong>${product.name}</strong></td>
        <td>${categoryName}</td>
        <td><strong>${product.price} –≥—Ä–Ω</strong></td>
        <td>
          <div class="action-buttons">
            <button class="btn btn-edit" onclick="openProductModal(${index})">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
            <button class="btn btn-danger" onclick="deleteProduct(${index})">üóëÔ∏è</button>
          </div>
        </td>
      </tr>
    `;
  });

  tbody.innerHTML = html;
}

function filterProducts() {
  const searchText = document.getElementById('productSearch').value.toLowerCase();
  const rows = document.querySelectorAll('#productsTableBody tr');

  rows.forEach(row => {
    const productName = row.dataset.productName || '';
    const productId = row.dataset.productId || '';
    
    if (productName.includes(searchText) || productId.includes(searchText)) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
}
  const searchText = document.getElementById('productSearch').value.toLowerCase();
  const rows = document.querySelectorAll('#productsTableBody tr');

  rows.forEach(row => {
    const productName = row.dataset.productName || '';
    const productId = row.dataset.productId || '';
    
    if (productName.includes(searchText) || productId.includes(searchText)) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
}

function deleteProduct(index) {
  if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä?')) {
    let products = JSON.parse(localStorage.getItem(STORAGE_KEYS.products)) || [];
    products.splice(index, 1);
    localStorage.setItem(STORAGE_KEYS.products, JSON.stringify(products));
    loadProducts();
    loadStats();
  }
}

// ===== –ó–ê–ú–û–í–õ–ï–ù–ù–Ø =====
function loadOrders() {
  const orders = JSON.parse(localStorage.getItem(STORAGE_KEYS.orders)) || [];
  const tbody = document.getElementById('ordersTableBody');

  if (orders.length === 0) {
    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px; color: #999;">üõí –ó–∞–º–æ–≤–ª–µ–Ω—å –ø–æ–∫–∏ –Ω–µ–º–∞—î</td></tr>';
    return;
  }

  let html = '';
  orders.forEach((order, index) => {
    const itemsCount = order.items.reduce((sum, item) => sum + item.quantity, 0);
    const orderDate = order.date ? new Date(order.date).toLocaleDateString('uk-UA') : '–ù–µ–≤—ñ–¥–æ–º–æ';

    html += `
      <tr>
        <td><strong>#${index + 1}</strong></td>
        <td>${orderDate}</td>
        <td>${order.customerName}</td>
        <td>${order.customerPhone}</td>
        <td>${order.customerAddress || '‚Äî'}</td>
        <td>${itemsCount} —à—Ç.</td>
        <td><strong>${order.total} –≥—Ä–Ω</strong></td>
        <td>
          <div class="action-buttons">
            <button class="btn btn-primary" onclick="viewOrder(${index})">üëÅÔ∏è –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</button>
            <button class="btn btn-danger" onclick="deleteOrder(${index})">üóëÔ∏è</button>
          </div>
        </td>
      </tr>
    `;
  });

  tbody.innerHTML = html;
}

function viewOrder(index) {
  const orders = JSON.parse(localStorage.getItem(STORAGE_KEYS.orders)) || [];
  const order = orders[index];
  
  let items = order.items.map(item => 
    `‚Ä¢ ${item.name} x${item.quantity} = ${item.price * item.quantity} –≥—Ä–Ω`
  ).join('\n');
  
  alert(`
üìã –ó–ê–ú–û–í–õ–ï–ù–ù–Ø #${index + 1}

üë§ –ö–ª—ñ—î–Ω—Ç: ${order.customerName}
üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${order.customerPhone}
üìç –ê–¥—Ä–µ—Å–∞: ${order.customerAddress || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}

üì¶ –¢–û–í–ê–†–ò:
${items}

üí∞ –ó–ê–ì–ê–õ–¨–ù–ê –°–£–ú–ê: ${order.total} –≥—Ä–Ω
  `);
}

function deleteOrder(index) {
  if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è?')) {
    let orders = JSON.parse(localStorage.getItem(STORAGE_KEYS.orders)) || [];
    orders.splice(index, 1);
    localStorage.setItem(STORAGE_KEYS.orders, JSON.stringify(orders));
    loadOrders();
    loadStats();
  }
}

// ===== –ï–ö–°–ü–û–†–¢ –î–ê–ù–ò–• =====
function exportData() {
  const data = {
    categories: JSON.parse(localStorage.getItem(STORAGE_KEYS.categories)) || [],
    products: JSON.parse(localStorage.getItem(STORAGE_KEYS.products)) || [],
    orders: JSON.parse(localStorage.getItem(STORAGE_KEYS.orders)) || [],
    exportDate: new Date().toISOString()
  };

  const dataStr = JSON.stringify(data, null, 2);
  const dataBlob = new Blob([dataStr], { type: 'application/json' });
  const url = URL.createObjectURL(dataBlob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `prozahist-backup-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  URL.revokeObjectURL(url);
}

function importData() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'application/json';
  
  input.onchange = function(e) {
    const file = e.target.files[0];
    const reader = new FileReader();
    
    reader.onload = function(event) {
      try {
        const data = JSON.parse(event.target.result);
        
        if (confirm('–¶–µ –∑–∞–º—ñ–Ω–∏—Ç—å –≤—Å—ñ –ø–æ—Ç–æ—á–Ω—ñ –¥–∞–Ω—ñ. –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏?')) {
          if (data.categories) localStorage.setItem(STORAGE_KEYS.categories, JSON.stringify(data.categories));
          if (data.products) localStorage.setItem(STORAGE_KEYS.products, JSON.stringify(data.products));
          if (data.orders) localStorage.setItem(STORAGE_KEYS.orders, JSON.stringify(data.orders));
          
          alert('‚úÖ –î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ!');
          location.reload();
        }
      } catch (error) {
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–º–ø–æ—Ä—Ç—É: ' + error.message);
      }
    };
    
    reader.readAsText(file);
  };
  
  input.click();
}

// ===== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø =====
checkAuth();

// –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
window.onclick = function(event) {
  const modal = document.getElementById('productModal');
  if (event.target === modal) {
    closeProductModal();
  }
}

// –ì–∞—Ä—è—á—ñ –∫–ª–∞–≤—ñ—à—ñ
document.addEventListener('keydown', function(e) {
  // ESC - –∑–∞–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
  if (e.key === 'Escape') {
    closeProductModal();
  }
  
  // Ctrl+S - –∑–±–µ—Ä–µ–≥—Ç–∏ —Ñ–æ—Ä–º—É —Ç–æ–≤–∞—Ä—É (—è–∫—â–æ –≤—ñ–¥–∫—Ä–∏—Ç–∞)
  if (e.ctrlKey && e.key === 's') {
    e.preventDefault();
    const modal = document.getElementById('productModal');
    if (modal.style.display === 'block') {
      document.getElementById('productForm').dispatchEvent(new Event('submit'));
    }
  }
});
</script>

</body>
</html>
